#!/usr/bin/env bash

# Pre-commit hook for CMPM 121 project
# This hook runs formatting checks, linting, and type checking before each commit

# These checks are taken from Demo 1 project provided by Adam Smith

# the build size check was suggested by 
# Brace when asked to improve the pre-commit hook with three.js and ammo.js added in
# then auto complited with copilot

echo "ğŸ” Running pre-commit checks..."

# Check if Deno is available
if ! command -v deno &> /dev/null; then
    echo "âŒ Deno is not installed or not in PATH"
    echo "Please install Deno: https://deno.land/"
    exit 1
fi

# Check formatting
echo "ğŸ“ Checking code formatting..."
if ! deno task fmt:check; then
    echo "âŒ Code formatting check failed"
    echo "Run 'deno task fmt' to fix formatting issues"
    exit 1
fi

# Run linter
echo "ğŸ” Running linter..."
if ! deno task lint; then
    echo "âŒ Linting failed"
    echo "Please fix the linting issues before committing"
    exit 1
fi

# Type checking
echo "ğŸ” Type checking..."
if ! deno task check; then
    echo "âŒ Type checking failed"
    echo "Please fix type errors before committing"
    exit 1
fi

# Build check (ensures Vite can build the project)
echo "ğŸ—ï¸ Testing build..."
if ! deno task build; then
    echo "âŒ Build failed"
    echo "Please fix build errors before committing"
    exit 1
fi

# checking the build size, warning for large assets
echo "ğŸ“¦ Checking build size..."
if ! deno task build:size; then
    echo "âš ï¸ Build size check warning"
    echo "Consider optimizing large assets before committing"
fi

echo "âœ… All pre-commit checks passed!"
exit 0